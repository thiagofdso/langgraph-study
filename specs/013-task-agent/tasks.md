# Tasks: Terminal Task Session Agent

**Input**: Design documents from `/specs/013-task-agent/`
**Prerequisites**: plan.md (required), spec.md (required for user stories), research.md, data-model.md, contracts/

**Note**: This task list is an integral part of the specification-driven development process, generated and managed using the `.specify` framework, ensuring clear task generation and alignment with project goals.

**Tests**: The specification does not request automated tests. Validation will rely on manual terminal walkthroughs described per user story.

**Organization**: Tasks are grouped by user story to enable independent implementation and testing of each story.

## Format: `[ID] [P?] [Story] Description`

- **[P]**: Can run in parallel (different files, no dependencies)
- **[Story]**: Which user story this task belongs to (e.g., US1, US2, US3)
- Include exact file paths in descriptions

## Phase 1: Setup (Shared Infrastructure)

**Purpose**: Establish project scaffolding and environment so development can start.

- [X] T001 Create new agente_tarefas package directory and placeholder module (agente_tarefas/__init__.py)
- [X] T002 Copy environment template from agente_simples/.env and document required GEMINI_API_KEY value (agente_tarefas/.env)
- [X] T003 Draft README with quickstart summary aligned to plan (agente_tarefas/README.md)

---

## Phase 2: Foundational (Blocking Prerequisites)

**Purpose**: Prepare shared runtime pieces required by every user story.

- [X] T004 Scaffold main entry file with dotenv load, ChatGoogleGenerativeAI client, and LangGraph imports (agente_tarefas/main.py)
- [X] T005 Define AgentState TypedDict with message history, task list, completion markers, and session timeline fields (agente_tarefas/main.py)
- [X] T006 Build StateGraph workflow with memory (`InMemorySaver`), node stub, and helper to invoke `app` without loops (agente_tarefas/main.py)

**Checkpoint**: Foundation readyâ€”user story implementation can now begin.

---

## Phase 3: User Story 1 - Capture initial task list (Priority: P1) ðŸŽ¯ MVP

**Goal**: Allow the learner to provide tasks in round 1, validate input, and see a numbered summary generated by the agent.

**Independent Test**: Start the agent, enter a comma-separated list like "Estudar matemÃ¡tica, Lavar louÃ§a", observe the echoed input, and confirm the agent responds with a numbered Portuguese list before moving to round 2.

*Tests not requested for this story; proceed to implementation tasks.*

### Implementation for User Story 1

- [X] T007 [US1] Wire CLI prompt for round 1 that captures user text once, echoes `UsuÃ¡rio:` plus input, and stores raw command (agente_tarefas/main.py)
- [X] T008 [US1] Implement parser to split and trim tasks, rejecting empty submissions with retry messaging that stays within round 1 (agente_tarefas/main.py)
- [X] T009 [US1] Update LangGraph node to append parsed tasks to state and call Gemini for numbered list response in Portuguese (agente_tarefas/main.py)
- [X] T010 [US1] Persist session timeline entry for round 1 and print agent output as `Agente:` to terminal (agente_tarefas/main.py)

**Checkpoint**: User Story 1 independently demonstrates task capture and summarization.

---

## Phase 4: User Story 2 - Mark a task as completed (Priority: P2)

**Goal**: Enable the learner to reference a task index in round 2, see the state update, and receive confirmation from the agent.

**Independent Test**: After completing round 1, enter `2` (or valid index). Verify the program echoes the input, marks the task as completed, and shows the updated list with a Gemini-generated confirmation before advancing.

*Tests not requested for this story; proceed to implementation tasks.*

### Implementation for User Story 2

- [X] T011 [US2] Prompt for round-2 task selection, echo the learner input, and log the command in state (agente_tarefas/main.py)
- [X] T012 [US2] Validate numeric selection, guard against out-of-range or already completed tasks, and update task status (agente_tarefas/main.py)
- [X] T013 [US2] Craft completion prompt for Gemini that reflects updated statuses and prints confirmation as `Agente:` (agente_tarefas/main.py)
- [X] T014 [US2] Record round-2 timeline entry including decision details and ensure flow advances exactly once (agente_tarefas/main.py)

**Checkpoint**: User Stories 1 and 2 function independently and sequentially.

---

## Phase 5: User Story 3 - Add new tasks in the final round (Priority: P3)

**Goal**: Allow the learner to append optional tasks, resolve duplicates, and see a final summary separating completed vs. pending items.

**Independent Test**: After round 2, enter new tasks (e.g., "Comprar frutas"), confirm duplicates are handled, and observe the final Portuguese summary with totals before the script exits.

*Tests not requested for this story; proceed to implementation tasks.*

### Implementation for User Story 3

- [X] T015 [US3] Prompt for additional tasks in round 3, echo the learner entry, and capture the command (agente_tarefas/main.py)
- [X] T016 [US3] Detect duplicate descriptions, request accept/skip confirmation within the round, and append validated tasks with source metadata (agente_tarefas/main.py)
- [X] T017 [US3] Generate final Gemini summary separating completed/pending tasks with totals and display closing message (agente_tarefas/main.py)
- [X] T018 [US3] Persist round-3 timeline entry and ensure the program exits after printing restart guidance (agente_tarefas/main.py)

**Checkpoint**: All user stories complete the three-round session independently.

---

## Phase 6: Polish & Cross-Cutting Concerns

**Purpose**: Consolidate documentation and manual verification across stories.

- [X] T019 Update agente_tarefas/README.md with final usage notes matching quickstart.md (agente_tarefas/README.md)
- [X] T020 Run through full three-round scenario and capture any adjustments needed in comments or README (manual execution)
- [X] T021 Add concise inline comments explaining LangGraph node responsibilities and memory usage (agente_tarefas/main.py)

---

## Dependencies & Execution Order

1. **Phase 1 â†’ Phase 2**: Setup tasks (T001â€“T003) must precede foundational work.
2. **Phase 2 â†’ User Stories**: Foundational tasks (T004â€“T006) block all user story phases.
3. **User Story Order**: US1 (T007â€“T010) â†’ US2 (T011â€“T014) â†’ US3 (T015â€“T018). Each story builds on previous state but remains independently testable after its prerequisites.
4. **Polish**: Tasks T019â€“T021 run after all user stories are functional.

## Parallel Execution Opportunities

- Documentation updates (T003, T019) can proceed in parallel once underlying files exist.
- Manual validation (T020) can occur simultaneously with comment refinements (T021) after implementation is feature-complete.
- Core implementation tasks share `agente_tarefas/main.py`; to avoid merge conflicts, execute sequentially even though certain subtasks (e.g., prompt crafting vs. timeline logging) could conceptually be split.

## Implementation Strategy

- **MVP Scope**: Complete Phases 1â€“3 (through T010) to deliver a functioning round-1 experience per User Story 1.
- **Incremental Delivery**: Add round-2 functionality (Phase 4) next, validating completion workflow, followed by round-3 enhancements (Phase 5).
- **Finalization**: Address documentation and small refinements in Phase 6 before preparing for review.
